---
title: "Red Wine Analysis"
author: "Nicholas Toscano"
date: "1/26/2019"
output:
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '3'
---
\newpage
Contents
==================== 

1.  Introduction
    -  Sourcing	
    -  Overview of Data
    -  Statisical Description
2.  Analysis
    -  Univariate Analysis
    -  Bivariate Analysis
    -  Multivariate Analysis
3.	Final Plots and Summary
    -  Reflections
    -  Challenges
    -  Successes
    -  Recommendations
4.	Appendices:
    -  Appendix A: Variability plots
    -  Appendix B: Additional Visualizations

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
options(scipen=999)
knitr::opts_chunk$set(comment = NA)
```

```{r check for and install missing packages, message=FALSE, warning=FALSE, include=FALSE}
packages = c("ggplot2", "GGally", "RColorBrewer", "reshape", "gridExtra", "dplyr", "scales", "knitr", "rmarkdown", "memisc")
package.check <- lapply(packages, FUN = function(x) {
  if (!require(x, character.only = TRUE)) {
    install.packages(x, dependencies = TRUE)
   library(x, character.only = TRUE)
  }
})

```

```{r call libraries, message=FALSE, warning=FALSE, include=FALSE}
library(ggplot2)
library(GGally)
library(RColorBrewer)
library(reshape)
library(gridExtra)
library(dplyr) 
library(scales) 
require(memisc)
library (knitr) 
library (rmarkdown)
```

```{r load data, include=FALSE}
getwd()
setwd("/Users/nick/Documents/Udacity/Project_3")
#Choose between red or white wine
wine <- read.csv("wineQualityReds.csv")
#wine <- read.csv("wineQualityWhites.csv")
```

\newpage
Introduction
==================== 

##Sourcing 

####What is the data source?

Citation:
* This dataset is public available for research. The details are described in [Cortez et al., 2009].
* P. Cortez, A. Cerdeira, F. Almeida, T. Matos and J. Reis. 
* Modeling wine preferences by data mining from physicochemical properties.
* In Decision Support Systems, Elsevier, 47(4):547-553. ISSN: 0167-9236.

The two datasets are related to red and white variants of the Portuguese "Vinho Verde" wine.vvFor more details, consult: http://www.vinhoverde.pt/en/ or the reference [Cortez et al., 2009]. Due to privacy and logistic issues, only physicochemical (inputs) and sensory (the output) variables are available (e.g. there is no data about grape types, wine brand, wine selling price, etc.).

* Number of Instances: red wine - 1599; white wine - 4898. 

* Number of Attributes: 11 + output attribute.

Note: white wine is not used in this analysis. The same code can be used to analyze the whie wine dataset, simply by switching the data loaded. Individual analysis and comments will differ and need to be updated.

##Overview of Data

####What is the structure of your dataset?
There are 1,599 red wines observations on basis of 11 features like (fixed.acidity volatile.acidity citric.acid residual.sugar, chlorides, free.sulfur.dioxide, total.sulfur.dioxide, density, pH,sulphates, alcohol,quality ) the chemical properties of the wine. The max quality provided in the data set is 8.

Quality: quality has most values concentrated in the categories 5, 6 and 7. Only a small proportion is in the categories [3, 4] and [8] and none in the categories [1, 2]

pH value: is considered to be a key parameter for the determination of quality of wine and hence the analysis focussed on determining the impact of these pH values on final quality determination.

Alcohol content: Alcohol content is an important parameter to impact the quality.In this dara set alcohol has an irregular shaped distribution. With min 9.4 to max 14.90.

####What is/are the main feature(s) of interest in your dataset?
The main features in the data set are alcohol content, pH and total acidity level (volatile.acidity+fixed.acidity+citric.acid)) to determine the quality. Iâ€™d like to determine which chemical properties influence the quality of red wines. We can check the acidity level and other variables to build a predictive model to determine the red quality.

####What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Free and total sulpher dioxide,citric.acid, fixed.acidity, and sulphates content likely contribute to the quality of the wine.We can find the correlation between the different variables to check which variable has high correlation with the quality.

####What is the structure of the dataset?
nrow(wine) and ncol(wine) can be used to test the number of observations and variables.  By running this piece of code we get the following output:
```{r wine data, echo=FALSE}
cat("There are", nrow(wine), "observations and", ncol(wine), "variables","\n")
```

str(wine) can be used to view the structure of the data.  This will tell us the format the data is being read.  
```{r wine structure, echo=FALSE}
print("The data structure for wine is:")
str(wine)
```
####What are the variables used in the dataset?
names(wine) can be used to observe the variables used in the dataset. The following variables are used in this dataset:
```{r wine variables, echo=FALSE}
print("The wine variables used in this study are:")
names(wine)
#summary(wine[2:13])
```

####Attribute information: 
1. fixed acidity: most acids involved with wine or fixed or nonvolatile (do not evaporate readily).
2. volatile acidity: the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste.
3. citric acid: found in small quantities, citric acid can add 'freshness' and flavor to wines.
4. residual sugar: the amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet.
5. chlorides: the amount of salt in the wine.
6. free sulfur dioxide: the free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine.
7. total sulfur dioxide: amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine.
8. density: the density of water is close to that of water depending on the percent alcohol and sugar content.
9. pH: describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale.
10 - sulphates: a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant.
11 - alcohol: the percent alcohol content of the wine.
Output variable (based on sensory data): 
12 - quality (score between 0 and 10).

For more information, read [Cortez et al., 2009].

####Data sample
Here is a sample fo the first 5 rows of wine:
```{r sample of the data, echo=FALSE}
head(wine,5)
```


##Statisitical Description:
```{r wine summary, echo=FALSE}
print("The following is a statistical summary for red wine:")
summary(wine[2:13])
```
\newpage
Analysis
==================== 

##Univariate Analysis

```{r echo=FALSE, }
Wp1<-ggplot(aes(x=pH), data = wine)+
   geom_histogram(color =I('black'),fill = I('#B22222'))+
  ggtitle('pH distribution for Red wine')
  
Wp2<-ggplot(aes(x=free.sulfur.dioxide),
       data =  wine)+
   geom_histogram(color =I('black'),fill = I('#B22222'))+
  ggtitle(' free.sulfur.dioxide distribution for Red wine')

Wp3<-ggplot(aes(x=total.sulfur.dioxide),
       data =  wine)+
   geom_histogram(color =I('black'),fill = I('#B22222'))+
  ggtitle('total.sulfur.dioxide distribution for Red wine')

Wp4<-ggplot(aes(x=alcohol),
       data =wine)+
   geom_histogram(color =I('black'),fill = I('#B22222'))+
  ggtitle('Alcohol distribution for Red wine')

grid.arrange(Wp1,Wp2,Wp3,Wp4,ncol=2)

```


##Bivariate Analysis

```{r echo=FALSE}
#ggpairs(wine, columns = c(2:13), columnLabels = c("f.acidity", "v.acidity", "c.acid", "res.sugar", "chlorides", "free.SO2", "total.SO2", "density", "pH", "sulphates", "alcohol","quality")) + theme(axis.title.y = element_text(size = 8))
ggscatmat(wine, columns = 2:13) + theme_grey(base_size=7)
```

The top 4 correlation coefficients with quality are:

* alchol:quality = 0.48
* sulphates:quality = 0.25
* citric.acid:quality = 0.23
* fixed.acidity:quality = 0.12

Alcohol content has a high correlation with red wine quality.  Other important attributes correlated with red wine quality include sulphates, citric acid and fixed acidity.  

The biggest negative corrlation coefficients with quality are:

* volatile.acidity:quality = -0.39
* total.sulfur.dioxide:quality = -0.19
* density:quality = -0.17
* chlorides:quality = -0.13

Volatile acids are negatively correlated with red wine quality.  Tota sulfur dioxide, density and chlorides are also negatively correlated with quality. 

Variables with the highest (positive or negative) correlation include:

* fixed.acidity:citirc.acid = 0.67
* fixed.acidity:density = 0.67
* free.sulfur.dioxide:total.sulfur.dioxide = 0.67
* alcohol:quality = 0.48
* density:alcohol = -0.50
* citric.acid:pH = -0.54
* volatile.acidity:citirc.acid = -0.55
* fixed.acidity:pH = -0.68

Below we can look at these relationships in a bit more detail.  Density and alcohol:
```{r echo=FALSE}
ggplot(wine, aes(density, alcohol)) + 
  geom_jitter(alpha=0.2) + 
  stat_smooth(method = "lm", formula = y ~ x)
```

This chart shows that density tends to increase with decreasing alcohol content.

Fixed acidity and pH:
```{r echo=FALSE}
ggplot(wine, aes(fixed.acidity, pH)) + 
  geom_jitter(alpha=0.2) + 
  stat_smooth(method = "lm", formula = y ~ x)
```

This chart shows that fixed acidity increase as pH decreases.

Fixed acidity and density:
```{r echo=FALSE}
ggplot(wine, aes(fixed.acidity, density)) + 
  geom_point(alpha=0.2) +  
  stat_smooth(method = "lm", formula = y ~ x)
```

On the other hand fixed acidity increases with density.

Now let's look at the alcohol content by red wine quality using a density plot function:
```{r echo=FALSE}
#I tried running the plot below but there was an error, likely because quality is an int, not a factor so I made quality a factor
ggplot(wine, aes(x=alcohol, fill=factor(quality))) + 
  geom_density(alpha=0.2)
```

It looks like the red wines with a higher alcohol content tend to have a higher quality rating...what a surprise!  The main anomoly to this trend appears to be red wines having a quality ranking of 5.

Here are the summary statistics for alcohol content at each quality level:
```{r echo=FALSE}
by(wine$alcohol, factor(wine$quality), summary)
```

```{r echo=FALSE}
ggplot(wine, aes(x=sulphates, fill=factor(quality))) + 
  geom_density(alpha=0.2)
```

It looks like sulphate content is quite important for red wine quality, particularly for the highest quality levels including quality 7 and 8.

And here are the summary statistics for sulphates at each quality level:
```{r echo=FALSE}
tapply(wine$sulphates, factor(wine$quality), summary)
```

##Multivariate Analysis

In this section we will visualize the relationship between sulphates, volatile.acidity, alcohol and quality:
```{r echo=FALSE}
ggplot(wine, aes(x=volatile.acidity, y=sulphates, size = alcohol, 
                 color=factor(quality))) + 
  geom_point() + 
  scale_color_brewer()
```

It looks like the higher quality red wines tend to be concentrated in the top left of the plot.  This tends to be where the higher alcohol content (larger dots) are concentrated as well.


Let's try summarizing quality using a contour plot of alcohol and sulphate content:
```{r echo=FALSE}
ggplot(wine, aes(x = sulphates, y = alcohol, 
                 colour=factor(wine$quality))) + 
  geom_density2d(bins=2) + 
  scale_color_brewer() + 
  geom_point(color="black", alpha=0.1) 
```

This shows that higher quality red wines are generally located near the upper right of the scatter plot (darker contour lines) wheras lower quality red wines are generally located in the bottom right.

Quality is visualized on the following chart using density plots along the x and y axis and color:
```{r echo=FALSE}
empty <- ggplot()+geom_point(aes(1,1), colour="white") +
     theme(                              
       plot.background = element_blank(), 
       panel.grid.major = element_blank(), 
       panel.grid.minor = element_blank(), 
       panel.border = element_blank(), 
       panel.background = element_blank(),
       axis.title.x = element_blank(),
       axis.title.y = element_blank(),
       axis.text.x = element_blank(),
       axis.text.y = element_blank(),
       axis.ticks = element_blank()
     )
main <- ggplot(wine, aes(x = sulphates, y = alcohol, 
                 color=factor(wine$quality))) + 
  geom_point() +
  theme(legend.position=c(1,1),legend.justification=c(1,1))
top <- ggplot(wine, aes(x = sulphates, 
                 fill=factor(wine$quality))) + 
  geom_density(alpha=0.5) + 
  theme(legend.position = "none")
  
right <- ggplot(wine, aes(x = alcohol, 
                 fill=factor(wine$quality))) + 
  coord_flip() + 
  geom_density(alpha=0.5) + 
  theme(legend.position = "none")
  
grid.arrange(top, empty, main, right, ncol=2, nrow=2, widths=c(4, 1), heights=c(1, 4))
```

Again, this clearly illustrates that higher quality wines are found near the top right of the plot.

\newpage
Final Plots and Summary
==================== 

###Reflections
This project was a good opportunity to apply R statisical analysis and utilize R visualization capabilities.  Also, this eexercise provides a good example of how a script could be used to analyze multiple sets of data.  This same code strcuture could be used to analyze the white wine dataset.

###Challenges
My first challenge was understanding the dataset.  Because I am not familiar with wine or chemistry, I had to read about the wine data in other sources to udnerstand what plots were meaningful and what variables could be compared.  Another challenge I faced was deciding what plots, stats, and other analytics were useful for this project.  Thsi project could quickly become overloaded with analytics that could clutter and reduce the overal value of the end product.  Adding color to plots became and important attirubte to helping distinguish variables.  

###Successes
I decided to streamline the project by using sumarrizing plots in teh main project and moving individual plots and analysis to the appendices.  This helped reduce overall clutter and provide a good flow to the end product.  

###Recommendations
If time were given, I would run the white wine dataset through the same plots and analysis to see what the result would be.  I would then compare the white wine and red wine results to see what difference occur between the two types of wine.  If provide, another interesting dataset to intersect with this analysis would be sales data on red and white wines.  I would like to see if certain mixes of variables sell better than others and at what price points.  Is there really a difference between a cheap wine and an expensive wine and can we quantity what that difference is?

\newpage
Appendices
==================== 
#Appendix A: Variability plots 

###Boxplots

```{r visualize variability of each variable wine, echo=FALSE}
meltData <- melt(wine[2:13])
ggplot(meltData, aes(factor(variable), value))+ 
geom_boxplot() + facet_wrap(~variable, scale="free")
```

###Summarized Histograms

```{r visualize distribution in variables wine, echo=FALSE}
ggplot(meltData, aes(x = value)) + 
facet_wrap(~variable,scales = "free_x") + 
geom_histogram()
```

#Appendix B: Additional Visualizations (Univariate)

The following histograms are provided for each variable.

###Quality 
```{r quality wine, echo=FALSE}
qplot(quality, main = "Wine", xlab = "Quality rating", ylab = "Count", binwidth = .5, data=wine, fill=I('#B22222'),col=I("#000000"))
```
The distribution of quality appears to be normal with many wines at average quality (4-5) and fewer wines at low quality and high quality. 

```{r summary wine quality, echo=FALSE}
summary(wine$quality)
```

###Alcohol content
```{r alcohol wine, echo=FALSE}
qplot(alcohol, main = "Wine", xlab = "Quality rating", ylab = "Count", binwidth = .25, data=wine, fill=I('#B22222'), col=I("#000000"))
```
The alcohol concentration distribution is right skewed. 

###Volatile.acidity  
```{r volatile acidity wine, echo=FALSE}
qplot(volatile.acidity, data=wine, main = "Wine", xlab = "Volatility rating", ylab = "Count", fill=I('#B22222'), binwidth = .01 ,col=I("#000000"))
```

```{r summary volatile acidity wine, echo=FALSE}
summary(wine$volatile.acidity)
```

###Citric.acid  

```{r citric acid, echo=FALSE}
qplot(citric.acid, data=wine, main = "Wine", xlab = "Citrict acid rating", ylab = "Count", fill=I('#B22222'), binwidth = .01, col=I("#000000"))
```

Most wines have 0 $g/dm^3$ of citric acid. This acid is always found in very small quantities. The distribution is right skewed with some ups and downs. We can see peaks at 0.250 and 0.500 which may hint at some bimodal behavior. A single wine appears far away on the right side with 1 $g/dm^3$ of citric acid.

```{r summary citric acid,  echo=FALSE}
summary(wine$citric.acid)
```

### residual.sugar

```{r residual sugar, echo=FALSE}
qplot(residual.sugar, data=wine, main = "Wine", xlab = "Sugar rating", ylab = "Count", fill=I('#B22222'), binwidth = .3, col=I("#000000"))
```


The distribution of residual sugar has a median value of 2.2 $g/dm^3$. The distribution is right skewed with a long tail in the right side. There are many small bars on the right side of the main peak.


```{r summary residual sugar, echo=FALSE}
summary(wine$residual.sugar)
```

###pH 
```{r pH, echo=FALSE}
qplot(pH, data=wine, main = "Wine", xlab = "pH rating", ylab = "Count", fill=I('#B22222'), binwidth = .01, col=I("#000000"))

```

The distribution seems symmetrical or could be also considered bimodal with both peaks very close to each other. There seems to be a local maximum at around 3.2 and then another one at 3.35.  The median value is 3.31, and most wines have a pH between 3.21 and 3.4.


```{r summary pH, echo=FALSE}
summary(wine$pH)
```

###density

```{r density, echo=FALSE}
qplot(density, data=wine, main = "Wine", xlab = "Density", ylab = "Count", fill=I('#B22222'), binwidth = .001, col=I("#000000"))

```

The density of wines varies few, with most of the values between 0.9956 and 0.9967. The distribution is almost symmetric and has median value of 0.9968 $g/cm^3$. The density if close to the density of water (1 $g/cm^3$ at 4 $^\circ C$).

```{r summary density, echo=FALSE}
summary(wine$density)
```

###chlorides

```{r chlorides, echo=FALSE, }
qplot(chlorides, data=wine, main = "Wine", xlab = "Chloride", ylab = "Count", fill=I('#B22222'), binwidth = .01, col=I("#000000"))+ xlim(.012, .2)
```

The amount of chlorides in the wines has a median value of 0.079 $g/dm^3$. The distribution with looks normal around its main peak but has a very long right tail, with small counts of wines with values until 0.611 $g/dm^3$


```{r summary chlorides, echo=FALSE}
summary(wine$chlorides)
```

###free.sulfur.dioxide 
```{r free sulfur dioxide, echo=FALSE}
qplot(free.sulfur.dioxide, data=wine, main = "Wine", xlab = "Free Sulfur Dioxide", ylab = "Count", fill=I('#B22222'), binwidth=10, col=I("#000000"))
```

The distribution of free sulfur dioxide concentrations is right skewed. The median value is 14 $mg/dm^3$. The right tail extends until a maximum of 72 with a gap between 57 and 66.


```{r summary free sulfur dioxide, echo=FALSE}
summary(wine$free.sulfur.dioxide)
```

### total.sulfur.dioxide

```{r total sulfur dioxide, echo=FALSE}
qplot(total.sulfur.dioxide, data=wine, main = "Wine", xlab = "Total Sulfur Dioxide", ylab = "Count", fill=I('#B22222'), col=I("#000000"))
```

The distribution of total sulfur dioxide is right skewed with a median value of 38 $mg/dm^3$. On the right tail we can see a local maximum near 80. There's a gap between 165 and 278 with only two wines with a concentration greater than or equal to 278.


```{r summary total sulfur dioxide, echo=FALSE}
summary(wine$total.sulfur.dioxide)
```

###sulphates

```{r sulphates, echo=FALSE}
qplot(sulphates, data=wine, main = "Wine", xlab = "Sulphates", ylab = "Count", fill=I('#B22222'), col=I("#000000"))
```

The distribution of sulphates is slightly right skewed. Some outliers on the right tail have around 2 g/dm^3 of sulphates.
The median value of sulphates is 0.62 and most wines have a concentration between 0.55 and 0.73.

```{r summary sulphates, echo=FALSE}
summary(wine$sulphates)
```
#Appendix C: Additional Visualizations (Bivariate)

We can quickly visualize the relationship between each pair of variables and find their pearson product-moment correlation. The names along the x and y axis of the plot matrix below are as follows:

```{r displa variables, echo=FALSE}
names(wine)[2:13]
```

```{r bivariate chart, echo=FALSE}
make_box_with_dots <- function(variable){
  ggplot(data = wine, aes_q(x = ~quality, y = as.name(variable)))+
    geom_boxplot()+
    geom_jitter(width = 0.7, alpha = 1/10)+
    geom_line(aes(group = 1),
                  stat = "summary",
                  fun.y = median,
                  color = "#E74C3C",
                  size = 1,
                  alpha = 0.8)
}
cond_median <- function(variable){
  print(paste("Median of", variable, "by quality:"))
  print(by(wine[[variable]], wine$quality, median))
}
boxplot_and_median <- function(variable){
  cond_median(variable)
  make_box_with_dots(variable)
}
```

### Fixed Acidity vs. Quality

```{r Fixed Acidity vs. Quality, echo=FALSE}
boxplot_and_median("fixed.acidity")
```

We see a very slight upwards trend of higher quality with higher fixed acidity. However, the extreme quality classes (3 and 8) have less observations than the middle ones, which may make the median value not so accurate. And we see a drop of acidity from 7 to the 8 quality class. Additionally, we see a big dispersion of acidity values across each quality scale. This may be a indicator that the quality cannot be predicted based only on the value of acidity and is the result of a combination of more variables.

## Volatile Acidity vs. Quality

```{r echo=FALSE}
boxplot_and_median("volatile.acidity")
```

Having in mind the same limitations as referred for the Fixed Acidity (extreme classes with less observations and variability inside the same quality class), we can see a more obvious trend. Lower volatile acidity seems to mean higher wine quality.

####Citric Acid vs. Quality

```{r Citric Acid vs. Quality, echo=FALSE}
boxplot_and_median("citric.acid")
```

Higher citric acid seems to mean a higher quality wine. The citric acid is always in low concentrations and in the univariate plots we saw that the distribution peaked at the zero value.

Let's see which proportion of wine has zero citric acid. For all the wine that proportion is:

```{r Citric Acid vs. Quality Qs,echo=FALSE}
# How many have zero citric acid
# Total Percentage
sum(wine$citric.acid == 0) / nrow(wine)
```

For each quality class the proportions are:

```{r Grouped Percentage, echo=FALSE}
# Grouped Percentage
group_by(wine, quality) %>%
  summarise(n_zero = sum(citric.acid == 0)/n())
```

We see a decreasing proportion of wine with zero citric acid on the higher quality classes.

So, this reinforces the first impression that the higher citric acid concentration relates to higher quality wine.

####Residual Sugar vs. Quality

```{r Residual Sugar vs. Quality, echo=FALSE}
boxplot_and_median("residual.sugar")
#removing the top 10% to be able to have a better look
boxplot_and_median("residual.sugar")+
  ylim(NA, quantile(wine$residual.sugar, 0.90))
```

Residual sugar seems to have a low impact in the quality of the wine.

####Chlorides vs. Quality

```{r Chlorides vs. Quality, echo=FALSE}
boxplot_and_median("chlorides")
boxplot_and_median("chlorides")+
  ylim(NA, quantile(wine$chlorides, 0.90))
```

A slight relation. Less chlorides means higher quality.

####Free sulfur dioxide vs. Quality

```{r Free sulfur dioxide vs. Quality,echo=FALSE}
boxplot_and_median("free.sulfur.dioxide")
```

The middle quality classes seem to have higher free sulfur dioxide than both the low and high quality.

According to the dataset description, when free SO2 is lower than 50 ppm (~ 50 mg/L), it is undetectable. We can see in the following plot that very few wine are above this threshold which leads us to think that the variations seen in this plot are not related to an effect of the free SO2, but to the non balanced distribution of wine across the quality classes.

```{r Free sulfur dioxide vs. Quality 2, echo=FALSE}
make_box_with_dots("free.sulfur.dioxide")+
  geom_hline(yintercept = 50, color = "#F1C40F", linetype = 2, size = 1.5)
```



####Total sulfur dioxide  vs. Quality

```{r Total sulfur dioxide  vs. Quality, echo = FALSE, warning=FALSE}
boxplot_and_median("total.sulfur.dioxide")+
  ylim(NA, 200)
```

Similar relation as with free sulfur dioxide. The middle classes have higher concentration than both the low and high.

####Density vs. Quality

```{r Density vs. Quality, echo=FALSE}
boxplot_and_median("density")
```

Lower density means higher quality. From the dataset descriptions we know that the density will depend on the percentage of alcohol and sugar content. We should check those relationships later.


####pH vs. Quality

```{r pH vs. Quality, echo=FALSE}
boxplot_and_median("pH")
```

There seems to be a trend of higher quality with lower pH. Higher quality with more acid content? We should check correlations between pH and the acidity levels.

## Sulphates vs. Quality

```{r Sulphates vs. Quality, echo=FALSE, warning=FALSE}
boxplot_and_median("sulphates")
boxplot_and_median("sulphates")+
  ylim(NA, quantile(wine$sulphates, 0.90))
```

Higher sulphates concentration means higher quality.

## Alcohol vs. Quality

```{r echo=FALSE}
boxplot_and_median("alcohol")
```

Besides the small downward bump in the quality class 5, the higher the alcohol content, the higher rated the wine get.

####Acidity and pH

```{r Acidity and pH, echo=FALSE}
ggplot(wine, aes(x = pH, y = fixed.acidity))+
  geom_point(alpha = 1/3)+
  scale_y_log10()
```

As expected the pH increases with the lower amount of acids. Fixed acidity accounts for most acids present in the wine.

```{r Acidity and pH2, echo= FALSE}
ggplot(wine, aes(x = pH, y = citric.acid))+
  geom_point(alpha = 1/3)+
  scale_y_log10()
```

A similar relation is seen with the citric acid variable. But since the citric acid is at lower concentrations, the relation is not so strong. pH will be dominated by the other acids.

```{r Acidity and pH 3, echo=FALSE}
ggplot(wine, aes(x = pH, y = volatile.acidity))+
  geom_point(alpha = 1/3)+
  scale_y_log10()
```

The volatile acidity seems to have either no relation with the pH or a slight positive correlation.

Correlation coefficient:

```{r echo=FALSE}
cor.test(~ pH + log10(volatile.acidity), data = wine)
```

The correlation coefficient shows a weak positive correlation of volatile.acidity with the pH. Maybe when the volatile acids are present in higher concentration, the concentration of the remaining acids is lower and that contributes to the increase of pH.

```{r eAcidity and pH 4, cho=FALSE}
ggplot(wine, aes(x = volatile.acidity, y = fixed.acidity))+
  geom_point(alpha = 1/2)
cor.test(~ fixed.acidity + volatile.acidity, data = wine)
```

We can see a weak negative correlation. On the plot, both variables seems to be have a natural limit on the lower sides. We have seen on the univariate plots that both are right skewed.

####Density, Sugar and Alcohol Content

The density of wine should be close to the water density, and will change depending on the percent of alcohol and sugar content.

```{r Density, Sugar and Alcohol Content, echo=FALSE, warning=FALSE}
ggplot(wine, aes(x = residual.sugar, y = density))+
  geom_point(alpha = 1/3)
ggplot(wine, aes(x = residual.sugar, y = density))+
  geom_point(alpha = 1/3)+
  xlim(NA, 4)
```

We see a increase of density with increase of residual sugar.

```{r Density, Sugar and Alcohol Content1, echo=FALSE}
ggplot(wine, aes(x = alcohol, y = density))+
  geom_point(alpha = 1/3)
```

And we see a decrease of density with increase of alcohol content.

```{r Density, Sugar and Alcohol Content2, echo=FALSE, warning=FALSE}
ggplot(wine, aes(x = alcohol, y = residual.sugar))+
  geom_point(alpha = 1/3)+geom_smooth()
ggplot(wine, aes(x = alcohol, y = residual.sugar))+
  geom_point(alpha = 1/3)+
  ylim(NA, 4)
cor.test(~ residual.sugar + alcohol, data = wine)
```

I was expecting a stronger correlation between the alcohol content and the residual sugar, since the alcohol comes from the fermentation of the sugars.

Maybe some of the wine are fortified with extra alcohol added that does not come from the fermentation of the sugar, or the yeast strains have different metabolic behaviors which do not allow to establish a linear relationship between sugar fermentation and alcohol production. Also, we don't know which grape types were used, which may have different sugar contents.


####Sulphates and sulfur oxide

Sulphate is an additive which can contribute to sulfur dioxide gas levels.

```{r Sulphates and sulfur oxide, echo=FALSE}
ggplot(wine, aes(x = sulphates, y = total.sulfur.dioxide))+
  geom_point(alpha = 1/5)
ggplot(wine, aes(x = sulphates, y = free.sulfur.dioxide))+
  geom_point(alpha = 1/5)
cor.test(~ total.sulfur.dioxide + sulphates, wine)
cor.test(~ free.sulfur.dioxide + sulphates, wine)
```

The relationship between sulphate levels and sulfur dioxide is very weak.

####Correlations with quality

```{r Correlations with quality, echo=FALSE}
cor(x = wine[1:11],
    y = as.numeric(wine$quality),
    method = "spearman")
```



